<!DOCTYPE html>
<html>
<head>
    <title>Marvel Champions Play Data</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@7/themes/algolia-min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="wrapper">
        <!-- Navigation tabs -->
        <div class="tab-container">
            <div class="tabs">
                <button class="tab-button active" data-tab="solo">Solo Heroes</button>
                <button class="tab-button" data-tab="team">Team Games</button>
            </div>
        </div>
        
        <div id="searchbox" class="searchbox"></div>
        <div class="stats-panel">
            <div class="time-filter">
                <h3>Select Time Period</h3>
                <div id="time-period"></div>
            </div>
            <!-- Make sure this div exists -->
            <div id="stats-container"></div>
        </div>
        <div class="hits"></div>
    </div>

    <!-- Templates -->
    <template id="hit-template">
        <div class="play-card">
            <h2>{{villain}}</h2>
            <div class="play-details">
                <p>Hero: {{hero}}</p>
                <p>Result: {{#win}}Victory! ðŸŽ‰{{/win}}{{^win}}Defeat ðŸ’€{{/win}}</p>
                <p>Date: {{date}}</p>
            </div>
        </div>
    </template>

    <template id="team-hit-template">
        <div class="play-card team-play">
            <h2>{{villain}}</h2>
            <div class="play-details">
                <p>Team: {{team_composition}}</p>
                <p>Result: {{#win}}Victory! ðŸŽ‰{{/win}}{{^win}}Defeat ðŸ’€{{/win}}</p>
                <p>Date: {{date}}</p>
            </div>
        </div>
    </template>

    <!-- Scripts in correct order -->
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.49.2/dist/instantsearch.production.min.js"></script>
    <script src="config.js"></script>
    <!-- Load click handlers before main script -->
    <script src="hero-direct-click.js"></script>
    <script src="index.js"></script>
    <script src="debug-click.js"></script>
        <!-- initTableSort is called from index.js after InstantSearch loads; avoid calling it here to prevent a race -->

        <!-- Temporary global error catcher: shows JS errors on-page and logs them to console. Remove when debugging is complete. -->
        <script>
            (function(){
                function showBanner(msg, bg) {
                    try {
                        const existing = document.getElementById('__global_js_error__');
                        if (existing) existing.remove();
                        const div = document.createElement('div');
                        div.id = '__global_js_error__';
                        div.style.background = bg || 'rgba(200,20,20,0.95)';
                        div.style.color = 'white';
                        div.style.padding = '8px';
                        div.style.position = 'fixed';
                        div.style.bottom = '8px';
                        div.style.right = '8px';
                        div.style.zIndex = 2147483647;
                        div.style.maxWidth = '480px';
                        div.style.fontFamily = 'monospace';
                        div.style.fontSize = '12px';
                        div.style.wordBreak = 'break-word';
                        div.textContent = msg;
                        document.body.appendChild(div);
                    } catch (e) {
                        // ignore
                    }
                }

                window.addEventListener('error', function(e) {
                    try {
                        const filename = e.filename || (e?.error && e.error.fileName) || '';
                        const lineno = e.lineno || (e?.error && e.error.lineNumber) || '';
                        const message = `${e.message} (${filename}:${lineno})`;
                        console.error('GlobalError:', message, e.error || e);
                        showBanner('JS Error: ' + message, 'rgba(200,20,20,0.95)');
                    } catch (ex) {
                        console.error('Error while reporting error', ex);
                    }
                });

                window.addEventListener('unhandledrejection', function(ev) {
                    try {
                        const reason = ev.reason && ev.reason.message ? ev.reason.message : String(ev.reason);
                        console.error('UnhandledRejection:', reason, ev.reason);
                        showBanner('UnhandledRejection: ' + reason, 'rgba(200,80,20,0.95)');
                    } catch (ex) {
                        console.error('Error while reporting rejection', ex);
                    }
                });
            })();
        </script>
</body>
</html>